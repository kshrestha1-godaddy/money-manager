// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id    Int     @id @default(autoincrement())
  email String?  @unique
  name  String?
  number String @unique
  password String
  profilePictureUrl String?
  currency String @default("USD") // User's preferred currency
  timezone String @default("UTC") // User's preferred timezone
  accounts Account[]
  categories Category[]
  expenses Expense[]
  incomes Income[]
  investments Investment[]
  investmentTargets InvestmentTarget[]
  budgetTargets BudgetTarget[]
  debts Debt[]
  loans Loan[]
  bookmarks Bookmark[]
  transactionBookmarks TransactionBookmark[]
  passwords Password[]
  notifications Notification[]
  dismissedNotifications DismissedNotification[]
  notificationSettings NotificationSettings?
  accountThresholds AccountThreshold[]
  userCheckins UserCheckin[]
  emergencyEmails EmergencyEmail[]
  passwordShares PasswordShare[]
  netWorthInclusions NetWorthInclusion[]
  activityLogs ActivityLog[]
  notes Note[]
  chatThreads ChatThread[]
  networthHistory NetworthHistory[]
  transactionImages TransactionImage[]
  goals Goal[]
  goalPhases GoalPhase[]
  goalProgress GoalProgress[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  id Int @id @default(autoincrement())
  holderName String
  accountNumber String @unique
  branchCode String
  bankName String
  branchName String
  bankAddress String
  accountType String
  mobileNumbers String[]
  branchContacts String[]
  swift String
  bankEmail String
  accountOpeningDate DateTime
  securityQuestion String[]
  balance Decimal @default(0)
  // Mobile App Details
  appUsername String?
  appPassword String?
  appPin String?
  // Notes and Nicknames
  notes String?
  nickname String?
  // Liquidity and Risk Assessment
  isLiquid Boolean @default(true)
  liquidityTimeframe LiquidityTimeframe @default(IMMEDIATE)
  riskLevel RiskLevel @default(VERY_LOW)
  isEmergencyFund Boolean @default(false)
  user User @relation(fields: [userId], references: [id])
  userId Int
  expenses Expense[]
  incomes Income[]
  investments Investment[]
  debts Debt[]
  loans Loan[]
  debtRepayments DebtRepayment[]
  loanRepayments LoanRepayment[]
  accountThreshold AccountThreshold[]
  goals Goal[] // Goals linked to this account
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id Int @id @default(autoincrement())
  name String
  type CategoryType
  color String @default("#6366f1")
  icon String?
  includedInBudget Boolean @default(true)
  user User @relation(fields: [userId], references: [id])
  userId Int
  expenses Expense[]
  incomes Income[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Expense {
  id Int @id @default(autoincrement())
  title String
  description String?
  amount Decimal
  currency String @default("USD") // Currency for the expense amount
  date DateTime @default(now())
  category Category @relation(fields: [categoryId], references: [id])
  categoryId Int
  account Account? @relation(fields: [accountId], references: [id])
  accountId Int?
  user User @relation(fields: [userId], references: [id])
  userId Int
  tags String[]
  location String[] // Locations where the expense occurred
  receipt String? // URL to receipt image
  notes String? // User notes/remarks for the expense
  isRecurring Boolean @default(false)
  recurringFrequency RecurringFrequency?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Income {
  id Int @id @default(autoincrement())
  title String
  description String?
  amount Decimal
  currency String @default("USD") // Currency for the income amount
  date DateTime @default(now())
  category Category @relation(fields: [categoryId], references: [id])
  categoryId Int
  account Account? @relation(fields: [accountId], references: [id])
  accountId Int?
  user User @relation(fields: [userId], references: [id])
  userId Int
  tags String[]
  location String[] // Locations where the income occurred
  receipt String? // URL to receipt/document image
  notes String? // User notes/remarks for the income
  isRecurring Boolean @default(false)
  recurringFrequency RecurringFrequency?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Investment {
  id Int @id @default(autoincrement())
  name String
  type InvestmentType
  symbol String? // Stock symbol, crypto symbol, etc.
  quantity Decimal
  purchasePrice Decimal
  currentPrice Decimal @default(0)
  purchaseDate DateTime
  account Account? @relation(fields: [accountId], references: [id])
  accountId Int?
  user User @relation(fields: [userId], references: [id])
  userId Int
  notes String?
  // Fixed Deposit specific fields
  interestRate Decimal? // Annual interest rate as percentage for fixed deposits
  maturityDate DateTime? // Maturity date for fixed deposits
  // Account deduction control
  deductFromAccount Boolean @default(true) // Whether to deduct investment amount from linked account balance
  // Liquidity and Risk Assessment
  isLiquid Boolean @default(false)
  liquidityTimeframe LiquidityTimeframe @default(DAYS)
  riskLevel RiskLevel @default(MEDIUM)
  hasMaturityDate Boolean @default(false)
  isInflationHedge Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model InvestmentTarget {
  id Int @id @default(autoincrement())
  investmentType InvestmentType
  targetAmount Decimal
  targetCompletionDate DateTime? // Target date for completing the investment goal
  nickname String? // Optional nickname for the investment target
  user User @relation(fields: [userId], references: [id])
  userId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([userId, investmentType])
  @@index([userId])
}

model BudgetTarget {
  id Int @id @default(autoincrement())
  name String
  targetAmount Decimal
  currentAmount Decimal @default(0)
  period BudgetPeriod
  startDate DateTime
  endDate DateTime
  user User @relation(fields: [userId], references: [id])
  userId Int
  isActive Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Debt {
  id Int @id @default(autoincrement())
  borrowerName String
  borrowerContact String?
  borrowerEmail String?
  amount Decimal
  interestRate Decimal @default(0) // Percentage interest rate
  dueDate DateTime?
  lentDate DateTime @default(now())
  status DebtStatus @default(ACTIVE)
  purpose String?
  notes String?
  // Liquidity and Risk Assessment
  isLiquid Boolean @default(false)
  liquidityTimeframe LiquidityTimeframe @default(MONTHS)
  riskLevel RiskLevel @default(MEDIUM)
  hasCollateral Boolean @default(false)
  borrowerCreditRating String?
  repayments DebtRepayment[]
  account Account? @relation(fields: [accountId], references: [id])
  accountId Int?
  user User @relation(fields: [userId], references: [id])
  userId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DebtRepayment {
  id Int @id @default(autoincrement())
  amount Decimal
  repaymentDate DateTime @default(now())
  notes String?
  debt Debt @relation(fields: [debtId], references: [id], onDelete: Cascade)
  debtId Int
  account Account? @relation(fields: [accountId], references: [id])
  accountId Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Bookmark {
  id Int @id @default(autoincrement())
  title String
  url String
  description String?
  category String?
  favicon String?
  tags String[]
  user User @relation(fields: [userId], references: [id])
  userId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Subscriber {
  id Int @id @default(autoincrement())
  email String @unique
  name String?
  phone String?
  status SubscriptionStatus @default(ACTIVE)
  subscribedAt DateTime @default(now())
  unsubscribedAt DateTime?
  // Subscription preferences
  newsletterEnabled Boolean @default(true)
  marketingEnabled Boolean @default(false)
  productUpdatesEnabled Boolean @default(true)
  weeklyDigestEnabled Boolean @default(true)
  // Additional fields
  source String? // How they subscribed (website, app, referral, etc.)
  tags String[] // Custom tags for segmentation
  lastEngagementAt DateTime? // Last time they opened an email or engaged
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WhitelistedEmail {
  id Int @id @default(autoincrement())
  email String @unique
  addedBy String? // Who added this email (admin email or system)
  reason String? // Reason for whitelisting
  isActive Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Loan {
  id             Int       @id @default(autoincrement())
  lenderName     String
  lenderContact  String?
  lenderEmail    String?
  amount         Decimal
  interestRate   Decimal   @default(0) // Percentage interest rate
  dueDate        DateTime?
  takenDate      DateTime  @default(now())
  status         LoanStatus @default(ACTIVE)
  purpose        String?
  notes          String?
  repayments     LoanRepayment[]
  account        Account?  @relation(fields: [accountId], references: [id])
  accountId      Int?
  user           User      @relation(fields: [userId], references: [id])
  userId         Int
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model LoanRepayment {
  id             Int       @id @default(autoincrement())
  amount         Decimal
  repaymentDate  DateTime  @default(now())
  notes          String?
  loan           Loan      @relation(fields: [loanId], references: [id], onDelete: Cascade)
  loanId         Int
  account        Account?  @relation(fields: [accountId], references: [id])
  accountId      Int?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Password {
  id             Int       @id @default(autoincrement())
  websiteName    String
  description    String
  username       String
  passwordHash   String    // Encrypted password
  transactionPin String?   // Encrypted transaction PIN
  validity       DateTime? // Password validity/expiration date
  notes          String?
  favicon        String?
  category       String?
  tags           String[]
  user           User      @relation(fields: [userId], references: [id])
  userId         Int
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Notification {
  id        Int      @id @default(autoincrement())
  title     String
  message   String
  type      NotificationType
  priority  NotificationPriority @default(NORMAL)
  isRead    Boolean  @default(false)
  actionUrl String?  // Optional URL for notification action
  metadata  Json?    // Additional data for the notification
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DismissedNotification {
  id               Int      @id @default(autoincrement())
  userId           Int
  notificationType NotificationType
  entityId         String   // Identifier for the specific entity (e.g., "debt-123")
  dismissedAt      DateTime @default(now())
  user             User     @relation(fields: [userId], references: [id])
  
  @@unique([userId, notificationType, entityId])
  @@index([userId, notificationType])
}

model NotificationSettings {
  id                    Int     @id @default(autoincrement())
  // Balance alerts
  lowBalanceEnabled     Boolean @default(true)
  lowBalanceThreshold   Decimal @default(500)
  // Due date alerts
  dueDateEnabled        Boolean @default(true)
  dueDateDaysBefore     Int     @default(7)
  // Spending alerts
  spendingAlertsEnabled Boolean @default(true)
  monthlySpendingLimit  Decimal @default(5000)
  // Investment alerts
  investmentAlertsEnabled Boolean @default(true)
  // High-value transaction auto-bookmarking
  autoBookmarkEnabled        Boolean @default(true)
  highValueIncomeThreshold   Decimal @default(50000)
  highValueExpenseThreshold  Decimal @default(10000)
  // General settings
  emailNotifications    Boolean @default(false)
  pushNotifications     Boolean @default(true)
  user                  User    @relation(fields: [userId], references: [id])
  userId                Int     @unique
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model AccountThreshold {
  id                  Int     @id @default(autoincrement())
  accountId           Int
  lowBalanceThreshold Decimal @default(500)
  account             Account @relation(fields: [accountId], references: [id], onDelete: Cascade)
  user                User    @relation(fields: [userId], references: [id])
  userId              Int
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@unique([accountId, userId])
  @@index([userId])
}

enum CategoryType {
  EXPENSE
  INCOME
}

enum RecurringFrequency {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

enum InvestmentType {
  STOCKS
  CRYPTO
  MUTUAL_FUNDS
  BONDS
  REAL_ESTATE
  GOLD
  FIXED_DEPOSIT
  PROVIDENT_FUNDS
  SAFE_KEEPINGS
  EMERGENCY_FUND
  MARRIAGE
  VACATION
  OTHER
}

enum BudgetPeriod {
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum DebtStatus {
  ACTIVE
  PARTIALLY_PAID
  FULLY_PAID
  OVERDUE
  DEFAULTED
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  UNSUBSCRIBED
  BOUNCED
}

enum LoanStatus {
  ACTIVE
  PARTIALLY_PAID
  FULLY_PAID
  OVERDUE
  DEFAULTED
}

enum NotificationType {
  LOW_BALANCE
  DUE_DATE_REMINDER
  SPENDING_ALERT
  INVESTMENT_MATURITY
  DEBT_REMINDER
  LOAN_REMINDER
  PASSWORD_EXPIRY
  MONTHLY_SUMMARY
  PASSWORD_SHARED
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

model TransactionBookmark {
  id Int @id @default(autoincrement())
  transactionType String // "INCOME" or "EXPENSE"
  transactionId Int
  title String
  description String?
  notes String?
  tags String[]
  user User @relation(fields: [userId], references: [id])
  userId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([transactionType, transactionId, userId])
}

model UserCheckin {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  checkinAt DateTime @default(now())
  ipAddress String?
  userAgent String?
  
  @@index([userId, checkinAt])
}

model EmergencyEmail {
  id        Int      @id @default(autoincrement())
  email     String
  label     String?  // Optional label like "Family", "Spouse", etc.
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([userId, email])
  @@index([userId])
}

model PasswordShare {
  id             Int      @id @default(autoincrement())
  user           User     @relation(fields: [userId], references: [id])
  userId         Int
  recipientEmail String
  sentAt         DateTime @default(now())
  passwordCount  Int      // Number of passwords shared
  shareReason    PasswordShareReason @default(INACTIVITY)
  secretKey      String?  // Optional: encrypted key used for sharing
  expiresAt      DateTime? // Optional: when the shared passwords expire
  
  @@index([userId, sentAt])
}

model NetWorthInclusion {
  id               Int      @id @default(autoincrement())
  user             User     @relation(fields: [userId], references: [id])
  userId           Int
  entityType       WorthEntityType // ACCOUNT, INVESTMENT, DEBT
  entityId         Int      // ID of the account, investment, or debt
  includeInNetWorth Boolean @default(true) // Whether to include in net worth calculation
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@unique([userId, entityType, entityId])
  @@index([userId, entityType])
  @@index([userId, includeInNetWorth])
}

model ActivityLog {
  id             Int      @id @default(autoincrement())
  user           User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         Int?     // Nullable for system-level activities
  
  // Activity classification
  action         ActivityAction    // CREATE, UPDATE, DELETE, READ, etc.
  entityType     ActivityEntityType // EXPENSE, INCOME, ACCOUNT, etc.
  entityId       Int?     // ID of the affected record (null for bulk operations)
  
  // Activity details
  description    String   // Human-readable description
  metadata       Json?    // Additional structured data (before/after values, etc.)
  
  // Request context
  ipAddress      String?
  userAgent      String?
  sessionId      String?
  
  // Categorization
  category       ActivityCategory @default(TRANSACTION) // For filtering and reporting
  severity       ActivitySeverity @default(INFO) // For importance/alerting
  
  // Status and result
  status         ActivityStatus @default(SUCCESS)
  errorMessage   String?  // If status is ERROR or FAILED
  
  // Performance tracking
  duration       Int?     // Execution time in milliseconds
  
  // Timestamps
  createdAt      DateTime @default(now())
  
  @@index([userId, createdAt])
  @@index([entityType, action])
  @@index([category, createdAt])
  @@index([status, severity])
  @@index([createdAt]) // For time-based queries
}

enum ActivityAction {
  CREATE
  UPDATE
  DELETE
  READ
  BULK_CREATE
  BULK_UPDATE
  BULK_DELETE
  BULK_IMPORT
  EXPORT
  LOGIN
  LOGOUT
  SHARE
  SYNC
  CALCULATE
  GENERATE
  SEND
}

enum ActivityEntityType {
  // Financial entities
  EXPENSE
  INCOME
  INVESTMENT
  DEBT
  LOAN
  ACCOUNT
  CATEGORY
  BUDGET_TARGET
  
  // Repayments
  DEBT_REPAYMENT
  LOAN_REPAYMENT
  
  // User management
  USER
  USER_PROFILE
  USER_SETTINGS
  
  // System entities
  NOTIFICATION
  PASSWORD
  BOOKMARK
  EMERGENCY_EMAIL
  PASSWORD_SHARE
  
  // Reports and analytics
  REPORT
  EXPORT
  IMPORT
  
  // Session and security
  SESSION
  AUTHENTICATION
  
  // Net worth
  NET_WORTH_INCLUSION
  
  // System
  SYSTEM
  CRON_JOB
  
  // Notes
  NOTE
}

enum ActivityCategory {
  TRANSACTION        // Expenses, incomes
  ACCOUNT           // Account management
  INVESTMENT        // Investment operations
  DEBT_LOAN         // Debt and loan operations
  AUTHENTICATION    // Login, logout
  SECURITY          // Password changes, shares
  NOTIFICATION      // Notification operations
  BUDGET            // Budget tracking
  REPORT            // Reports and exports
  SYSTEM            // System operations
  USER_MANAGEMENT   // User profile changes
  BULK_OPERATION    // Bulk imports/deletes
  NOTE              // Note operations
}

enum ActivitySeverity {
  DEBUG     // Detailed debug information
  INFO      // General informational messages
  WARNING   // Warning messages
  ERROR     // Error messages
  CRITICAL  // Critical system issues
}

enum ActivityStatus {
  SUCCESS
  FAILED
  ERROR
  PARTIAL  // For bulk operations
  PENDING
}

enum WorthEntityType {
  ACCOUNT     // Bank accounts
  INVESTMENT  // Investment holdings
  DEBT        // Money lent out
}

enum PasswordShareReason {
  INACTIVITY    // Sent due to user inactivity
  MANUAL        // Manually triggered by user
}

enum LiquidityTimeframe {
  IMMEDIATE
  DAYS
  WEEKS
  MONTHS
  YEARS
}

enum RiskLevel {
  VERY_LOW
  LOW
  MEDIUM
  HIGH
  VERY_HIGH
}

model Note {
  id Int @id @default(autoincrement())
  title String
  content String? // Rich text content
  color String @default("#fbbf24") // Default yellow color like Google Keep
  isPinned Boolean @default(false)
  isArchived Boolean @default(false)
  tags String[]
  imageUrl String? // Optional image attachment URL
  
  // Financial context - optional relationships to financial entities
  relatedExpenseId Int?
  relatedIncomeId Int?
  relatedInvestmentId Int?
  relatedDebtId Int?
  relatedLoanId Int?
  relatedAccountId Int?
  
  // Financial values and dates for important notes
  amount Decimal? // Optional amount if the note is about a financial value
  currency String @default("USD") // Currency for the amount
  noteDate DateTime? // Important date related to the note (different from creation date)
  reminderDate DateTime? // Optional reminder date
  
  // Metadata
  user User @relation(fields: [userId], references: [id])
  userId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([userId, isPinned])
  @@index([userId, isArchived])
  @@index([userId, createdAt])
  @@index([userId, reminderDate])
}

model ChatThread {
  id Int @id @default(autoincrement())
  title String // Thread title (auto-generated or user-defined)
  description String? // Optional description of the thread
  isActive Boolean @default(true) // Whether the thread is active
  isPinned Boolean @default(false) // Whether the thread is pinned to top
  lastMessageAt DateTime @default(now()) // Timestamp of last message for sorting
  
  // Relationships
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int
  conversations ChatConversation[]
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([userId, lastMessageAt])
  @@index([userId, isPinned])
  @@index([userId, isActive])
}

model ChatConversation {
  id Int @id @default(autoincrement())
  content String // Message content
  sender ChatSender // USER or ASSISTANT
  messageType ChatMessageType @default(TEXT) // TEXT, IMAGE, FILE, etc.
  
  // Processing metadata
  isProcessing Boolean @default(false) // Whether the message is being processed
  processingSteps Int @default(0) // Number of processing steps taken
  
  // File attachments (if any)
  attachments Json? // Array of file attachments with metadata
  
  // Processing and system data
  intermediateSteps Json? // Array of processing steps with timestamps and context
  systemPrompt Json? // System prompt data including financial context
  inputTokens Int? // Input tokens sent to LLM
  outputTokens Int? // Output tokens received from LLM
  
  // Feedback and analytics
  feedback ChatFeedback? // Like/dislike feedback from user
  comments String? // User comments on the conversation
  responseTimeSeconds Float? // Time taken to complete the response (in seconds)
  tokenCount Int? // Number of tokens in the response
  
  // Relationships
  thread ChatThread @relation(fields: [threadId], references: [id], onDelete: Cascade)
  threadId Int
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([threadId, createdAt])
  @@index([sender, createdAt])
  @@index([feedback])
}

enum ChatSender {
  USER
  ASSISTANT
}

enum ChatMessageType {
  TEXT
  IMAGE
  FILE
  SYSTEM
  ERROR
}

enum ChatFeedback {
  LIKE
  DISLIKE
}

model NetworthHistory {
  id                           Int      @id @default(autoincrement())
  
  // Snapshot data matching NetWorthSnapshot interface
  totalAccountBalance          Decimal  @default(0)
  totalInvestmentValue         Decimal  @default(0)
  totalInvestmentCost          Decimal  @default(0)
  totalInvestmentGain          Decimal  @default(0)
  totalInvestmentGainPercentage Decimal @default(0)
  totalMoneyLent               Decimal  @default(0)
  totalAssets                  Decimal  @default(0)
  netWorth                     Decimal  @default(0)
  currency                     String   @default("USD")
  
  // Date this snapshot represents (can be different from createdAt for historical data)
  snapshotDate                 DateTime @default(now())
  
  // How this record was created
  recordType                   NetWorthRecordType @default(AUTOMATIC)
  
  // User relationship
  user                         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                       Int
  
  // Metadata
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime @updatedAt
  
  // Indexes for efficient querying
  @@index([userId, snapshotDate])
  @@index([userId, recordType])
  @@index([userId, createdAt])
  @@unique([userId, snapshotDate]) // Prevent duplicate snapshots for same user on same date
}

enum NetWorthRecordType {
  AUTOMATIC  // Created by cron job
  MANUAL     // Created by user action
}

model TransactionImage {
  id              Int                    @id @default(autoincrement())
  imageUrl        String                 // Vercel blob URL
  fileName        String                 // Original filename
  fileSize        Int?                   // Size in bytes
  mimeType        String?                // MIME type (image/jpeg, image/png, etc.)
  transactionType TransactionImageType   // Type of transaction this image belongs to
  transactionId   Int                    // ID of the related transaction
  description     String?                // Optional description of the image
  isActive        Boolean                @default(true) // For soft delete
  uploadedAt      DateTime               @default(now()) // When the image was uploaded
  
  // Relationships
  user            User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          Int
  
  // Metadata
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  
  // Indexes for efficient querying
  @@index([userId, transactionType])
  @@index([transactionType, transactionId])
  @@index([userId, uploadedAt])
  @@index([userId, isActive])
}

enum TransactionImageType {
  EXPENSE
  INCOME
  INVESTMENT
  DEBT
  LOAN
}

model Goal {
  id                   Int           @id @default(autoincrement())
  title                String        // Name of the goal
  description          String?       // Detailed description of the goal
  
  // Financial aspects
  targetAmount         Decimal?      // Target financial amount (optional)
  currentAmount        Decimal       @default(0) // Current progress amount
  currency             String        @default("USD")
  
  // Timeline
  startDate            DateTime      // When the goal begins
  targetCompletionDate DateTime?     // Expected completion date
  actualCompletionDate DateTime?     // Actual completion date
  
  // Goal metadata
  priority             Int           @default(1) // Priority/sequence number (1 = highest)
  status               GoalStatus    @default(PLANNING)
  category             String?       // Custom category (e.g., "Emergency Fund", "Investment")
  tags                 String[]      // Custom tags for organization
  color                String        @default("#6366f1") // Visual color for the goal
  
  // Context and notes
  notes                String?       // Additional notes
  successCriteria      String?       // What defines success for this goal
  
  // Optional financial relationships
  account              Account?      @relation(fields: [accountId], references: [id])
  accountId            Int?          // Link to specific account if applicable
  
  // Risk and liquidity (following existing patterns)
  riskLevel            RiskLevel     @default(LOW)
  isPublic             Boolean       @default(false) // Whether goal is shareable/public
  
  // Relationships
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId               Int
  phases               GoalPhase[]   // Different phases (Dev, Prod, Post)
  progress             GoalProgress[] // Progress tracking over time
  
  // Standard timestamps
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  
  // Indexes for efficient queries
  @@index([userId, status])
  @@index([userId, startDate])
  @@index([userId, priority])
  @@index([userId, category])
  @@index([userId, createdAt])
}

model GoalPhase {
  id                   Int           @id @default(autoincrement())
  name                 String        // Phase name (e.g., "Dev", "Prod", "Post")
  description          String?       // Phase description
  
  // Timeline for this phase
  plannedStartDate     DateTime      // When this phase should start
  plannedEndDate       DateTime      // When this phase should end
  actualStartDate      DateTime?     // When this phase actually started
  actualEndDate        DateTime?     // When this phase actually ended
  
  // Phase progress
  status               GoalPhaseStatus @default(PLANNED)
  progressPercentage   Int           @default(0) // 0-100
  
  // Phase metadata
  sequenceOrder        Int           // Order within the goal (1, 2, 3...)
  estimatedDuration    Int?          // Estimated duration in days
  actualDuration       Int?          // Actual duration in days
  
  // Context
  notes                String?       // Phase-specific notes
  requirements         String?       // What needs to be done in this phase
  deliverables         String?       // Expected outcomes from this phase
  
  // Relationships
  goal                 Goal          @relation(fields: [goalId], references: [id], onDelete: Cascade)
  goalId               Int
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId               Int
  progress             GoalProgress[] // Progress entries for this phase
  
  // Standard timestamps
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  
  // Indexes
  @@index([goalId, sequenceOrder])
  @@index([userId, status])
  @@index([goalId, plannedStartDate])
  @@unique([goalId, sequenceOrder]) // Ensure unique sequence per goal
}

model GoalProgress {
  id                   Int           @id @default(autoincrement())
  
  // Progress tracking
  progressPercentage   Int           // Overall progress percentage (0-100)
  amountProgress       Decimal?      // Amount progress if goal has target amount
  milestoneReached     String?       // Description of milestone reached
  
  // Progress context
  notes                String?       // Progress notes
  challenges           String?       // Challenges faced
  nextSteps            String?       // Next planned actions
  
  // Progress metadata
  progressDate         DateTime      @default(now()) // Date of this progress entry
  isAutomaticUpdate    Boolean       @default(false) // Was this auto-calculated or manual entry
  
  // Optional phase context
  phase                GoalPhase?    @relation(fields: [phaseId], references: [id])
  phaseId              Int?          // Which phase this progress relates to
  
  // Relationships
  goal                 Goal          @relation(fields: [goalId], references: [id], onDelete: Cascade)
  goalId               Int
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId               Int
  
  // Standard timestamps
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  
  // Indexes
  @@index([goalId, progressDate])
  @@index([userId, progressDate])
  @@index([goalId, createdAt])
}

enum GoalStatus {
  PLANNING     // Goal is being planned/designed
  ACTIVE       // Goal is actively being worked on
  ON_HOLD      // Goal is temporarily paused
  COMPLETED    // Goal has been achieved
  CANCELLED    // Goal has been cancelled
  OVERDUE      // Goal has passed its target completion date
}

enum GoalPhaseStatus {
  PLANNED      // Phase is planned but not started
  IN_PROGRESS  // Phase is currently active
  COMPLETED    // Phase is completed
  BLOCKED      // Phase is blocked by dependencies
  CANCELLED    // Phase has been cancelled
  OVERDUE      // Phase has passed its planned end date
}
